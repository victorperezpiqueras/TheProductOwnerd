<div class="container" fxFlex="100">
  <app-loader class="loader" [isLoading]="isLoading"></app-loader>
  <div *ngIf="proyecto" fxLayout="column" fxLayoutGap="1%">
    <div fxFlex="20" fxLayout="row" fxLayoutGap="2%">
      <mat-card fxFlex="20" class="title-card mat-elevation-z3">
        <mat-card-header>
          <mat-card-title style="font-size: x-large">
            <span *ngIf="(permisos && permisos.archivarProyecto === 0) || !editProjectMode">{{ proyecto.nombre }}</span>

            <mat-form-field *ngIf="permisos && permisos.archivarProyecto === 1 && editProjectMode">
              <input matInput [(ngModel)]="proyecto.nombre" />
            </mat-form-field>
            &nbsp;

            <button
              *ngIf="permisos && permisos.archivarProyecto === 1 && !editProjectMode"
              mat-raised-button
              (click)="editMode()"
              color="primary"
            >
              <mat-icon>edit</mat-icon>
            </button>

            <button
              *ngIf="permisos && permisos.archivarProyecto === 1 && editProjectMode"
              mat-raised-button
              (click)="guardarProyecto()"
              [color]="'success'"
            >
              <mat-icon>save</mat-icon>
            </button>
          </mat-card-title>

          <mat-card-subtitle style="text-align: justify;">
            <span class="descripcion" *ngIf="(permisos && permisos.archivarProyecto === 0) || !editProjectMode">{{
              proyecto.descripcion
            }}</span>

            <mat-form-field
              *ngIf="permisos && permisos.archivarProyecto === 1 && editProjectMode"
              appearance="outline"
              style="width: 120%;"
            >
              <mat-label class="mat-h2">Description</mat-label>
              <textarea matInput [(ngModel)]="proyecto.descripcion" style="height: 200px;"></textarea>
            </mat-form-field>
          </mat-card-subtitle>
        </mat-card-header>
      </mat-card>

      <mat-card fxFlex="80" class="sprint-card mat-elevation-z3">
        <mat-card-header>
          <mat-card-title style="font-size: x-large">Sprint: </mat-card-title>
          <mat-icon
            class="arrow-icon"
            (click)="previousSprint()"
            *ngIf="permisos && permisos.sprintGoals === 1"
            matTooltip="Switch to the previous sprint (requires confirmation)"
            matTooltipPosition="below"
            matTooltipShowDelay="500"
            [ngStyle]="{ color: isFirstSprint ? '#cacaca' : '#000000' }"
            >chevron_left</mat-icon
          >
          <h1 class="mat-h1" style="font-size: xx-large">{{ proyecto.sprintActual }}</h1>
          <mat-icon
            class="arrow-icon"
            (click)="nextSprint()"
            *ngIf="permisos && permisos.sprintGoals === 1"
            matTooltip="Switch to the next sprint (requires confirmation)"
            matTooltipPosition="below"
            matTooltipShowDelay="500"
            >chevron_right
          </mat-icon>
        </mat-card-header>
        <mat-card-content>
          <div style="margin-left: 15px;">
            <!-- <b>Sprint Goal: </b><br> -->
            <div *ngIf="showingGoal && permisos && permisos.sprintGoals === 1">
              <mat-form-field appearance="outline" style="width: 90%;">
                <mat-label class="mat-h2">Sprint Goal</mat-label>
                <textarea matInput [(ngModel)]="showingGoal.goal" (change)="switchSaveButton()"></textarea>
              </mat-form-field>
              <button
                mat-raised-button
                (click)="guardarSprintGoal()"
                [color]="'success'"
                [disabled]="buttonDisabled"
                style="margin-left: 2%;display: inline-block;width: 9vmin;height: 5vmin;min-width: 100px;min-height: 50px;"
              >
                <mat-icon>save</mat-icon>&nbsp;&nbsp;Save
              </button>
            </div>
            <div *ngIf="showingGoal && permisos && permisos.sprintGoals === 0">
              <b class="mat-h3"><b>Goal: </b></b>
              <p style="color: rgb(119, 119, 119);display: inline-block;margin-top: 5px; text-align: justify;">
                {{ showingGoal.goal }}
              </p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!--  <mat-card fxFlex="20">
      <mat-card-header>
        <mat-card-title style="font-size: x-large">{{ proyecto.nombre }}</mat-card-title>
        <mat-card-subtitle>{{ proyecto.descripcion }}</mat-card-subtitle>
        <mat-card fxLayout="row" fxLayoutGap="10px" style="float:right;margin-left:auto; margin-right:0;background-color: #f5f5f5;">
          <h1 class="mat-h2">Sprint: </h1>
          <mat-icon class="arrow-icon" (click)="previousSprint();" [ngStyle]="{ 'color': isFirstSprint ? '#cacaca' : '#000000' }">chevron_left</mat-icon>
          <h1 class="mat-h1">{{proyecto.sprintActual}}</h1>
          <mat-icon class="arrow-icon" (click)="nextSprint();">chevron_right</mat-icon>
        </mat-card>
      </mat-card-header>
    </mat-card> -->

    <mat-card class="main-card gradient" fxFlex="80" *ngIf="permisos && proyecto">
      <mat-tab-group
        class="gradient"
        mat-align-tabs="center"
        [selectedIndex]="0"
        (selectedTabChange)="onTabChanged($event)"
      >
        <mat-tab label="Overview">
          <app-overview #overview [proyecto]="proyecto" [permisos]="permisos"></app-overview>
        </mat-tab>

        <mat-tab label="Backlog">
          <app-backlog #backlog [proyecto]="proyecto" [permisos]="permisos"></app-backlog>
        </mat-tab>

        <mat-tab label="Forecasts" [disabled]="permisos.proyecciones != 1">
          <ng-template mat-tab-label>
            <span
              matTooltip="Only Product Owners can access this menu"
              [matTooltipDisabled]="permisos.proyecciones == 1"
              matTooltipShowDelay="500"
              >Forecasts</span
            >
          </ng-template>
          <app-forecasts #forecasts [proyecto]="proyecto" [permisos]="permisos"></app-forecasts>
        </mat-tab>
      </mat-tab-group>
    </mat-card>
    <!-- <mat-card fxFlex="40">
      <mat-card-subtitle>Equipo:</mat-card-subtitle>
      <table mat-table [dataSource]="proyecto.usuarios" class="mat-elevation-z8" fxFill>
        <ng-container matColumnDef="Rol">
          <th mat-header-cell *matHeaderCellDef>Rol</th>
          <td mat-cell *matCellDef="let usuario">{{ usuario.rol }}</td>
        </ng-container>
        <ng-container matColumnDef="Nombre">
          <th mat-header-cell *matHeaderCellDef>Nombre</th>
          <td mat-cell *matCellDef="let usuario">{{ usuario.nombre }}</td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </mat-card> -->
    <!-- <div fxLayout="row" fxLayoutGap="2%" fxFlex="40">
      <mat-card fxFlex="50">
        <highcharts-chart
          [Highcharts]="Highcharts"
          [options]="chartOptions"
          style="width: 100%; height: 400px; display: block;"
        ></highcharts-chart>
      </mat-card>
      <mat-card fxFlex="50">
        <mat-card-title>{{ proyecto.nombre }}</mat-card-title>
        <mat-card-subtitle>{{ proyecto.descripcion }}</mat-card-subtitle>
      </mat-card>
    </div> -->
  </div>
</div>
